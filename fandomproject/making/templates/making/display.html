{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alive_Album</title>
    <!-- Css Styles -->
    <link rel="stylesheet" href="{% static 'mkcss/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'mkcss/rockville.css'%}" />
    <link rel="stylesheet" href="{% static 'mkcss/slicknav.min.css'%}" />
    <link rel="stylesheet" href="{% static 'mkcss/index.css'%}" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cantata+One&display=swap" rel="stylesheet">
  </head>
  <body>
    <!-- Page Preloder -->
    <div id="preloder">
      <div class="loader"></div>
    </div>
    <header class="header">
      <div class="container">
        <div class="row">
          <div class="col-lg-2 col-md-2">
            <div class="header__logo">
              <a href="/"
                ><img
                  src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FnuwrN%2Fbtsl1AGHVn5%2FW0ET9hk7cnZqIvuz4MdXV0%2Fimg.png"
                  alt=""
              /></a>
            </div>
          </div>
          <div class="col-lg-10 col-md-10">
            <div class="header__nav">
              <nav class="header__menu mobile-menu">
                <ul>
                  <li><a href="/">Home</a></li>
                  <li class=><a href="/challenge">Challenge</a></li>
                  {% if user.nickname %}
                  <li class="active"><a href="/making">Making</a></li>
                  {% endif %}
                  <li><a href="/ranking">Ranking</a></li>
                  <li><a href="/videogallery">Board</a></li>
                  {% if user.username %}
                  <li>
                  <a href="/logout">Logout</a>
                  </li>
                  {% else %}
                  <li>
                  <a href="/login">Login</a>
                  </li>
                  {% endif%}
                </ul>
              </nav>
            </div>
          </div>
        </div>
        <div id="mobile-menu-wrap"></div>
      </div>
    </header>
    <!-- Main -->
    <div class="wrapper style1">
      <div class="container">
        <div id="root">
          <div class="Contents">
            <div class="upload-box" style="margin-bottom: 200px">
              <svg viewBox="0 0 2500 400" style="width: 100%">
                <symbol id="s-text">
                  <text text-anchor="middle" x="50%" y="80%">Success</text>
                </symbol>
                <g class="g-ants">
                  <use xlink:href="#s-text" class="text-copy"></use>
                  <use xlink:href="#s-text" class="text-copy"></use>
                  <use xlink:href="#s-text" class="text-copy"></use>
                  <use xlink:href="#s-text" class="text-copy"></use>
                  <use xlink:href="#s-text" class="text-copy"></use>
                </g>
              </svg>
              <div id="drop-file" style="text-align: center">
                {% if transformed_image_url %}
                <img
                  id="transformed-image"
                  src="{{ transformed_image_url }}"
                  alt="Transformed Image"
                  style="margin-bottom: 20px"
                />
                <br />

                <div style="display: flex; justify-content: space-between">
                  <button
                    id="post-btn"
                    onclick="handleClick()"
                    data-url="{% url 'making:post_image' %}"
                    data-csrf-token="{{ csrf_token }}"
                    style="width: 90px; height: 50px"
                  >
                    Post
                  </button>
                  <button
                    id="goto-index"
                    onclick="window.location.href='{% url 'main_index' %}'"
                    style="width: 90px; height: 50px"
                  >
                    Home
                  </button>

                  <button
                    id="download-btn"
                    onclick="downloadImage('{{ transformed_image_url }}')"
                    style="width: 90px; height: 50px"
                  >
                    Download
                  </button>
                </div>

                <script>
                  function handleClick() {
                    // Execute your function here
                    const button = document.getElementById("post-btn");
                    const url = button.dataset.url;
                    const scrfToken = button.dataset.csrfToken;
                    postImage("{{ nickname }}", "{{ transformed_image_url }}");
                    // Redirect to another HTML file
                    //window.location.href = '{% url 'main_index' %}'
                  }
                </script>
                {% else %}
                <p>No transformed image available.</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="footer spad set-bg" data-setbg="">
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-md-6">
            <div class="footer__address">
              <ul>
                <li>
                  <a href="/policy" target="_blank" style="color: white"
                    >이용약관</a
                  >
                </li>
                <li>
                  <a href="/privacy" target="_blank" style="color: white"
                    >개인정보 처리방침</a
                  >
                </li>
                <li>
                  <h2 style="color: white">ALIVE</h2>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-lg-4 offset-lg-1 col-md-6">
            <div class="footer__social">
              <div class="footer__social__links">
                <p>주소 부분</p>
                <p style="color: white">
                  광주광역시 북구 신안동 무등로202번길 15<br />KT신안빌딩
                </p>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="footer__address" style="margin-left: 90px">
              <ul style="display: flex">
                <li class="icon_li">
                  <a
                    href="https://www.youtube.com/watch?v=oSfiSswjiBQ&list=PL_WCuvyChN3g7tC-_q1UexhM61t51yPM_"
                    target="_blank"
                    style="color: white"
                  >
                    <img
                      src="/static/img/youtube.png"
                      alt=""
                      style="width: 50px"
                    />
                  </a>
                </li>
                <li class="icon_li">
                  <a
                    href="https://github.com/Junobee25/ai-33-project/tree/develop"
                    target="_blank"
                    style="color: white"
                  >
                    <img
                      src="/static/img/github.png"
                      alt=""
                      style="width: 50px"
                    />
                  </a>
                </li>
                <li class="icon_li">
                  <a
                    href="https://www.instagram.com/aivlestory/"
                    target="_blank"
                    style="color: white"
                  >
                    <img
                      src="/static/img/instagram.png"
                      alt=""
                      style="width: 50px"
                    />
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
        <div class="footer__copyright__text">
          <p>
            Copyright &copy; 카피라이트 부분
            <script>
              document.write(new Date().getFullYear());
            </script>
            All rights reserved | This template is made with
            <i class="fa fa-heart" aria-hidden="true"></i> by
            <a href="https://colorlib.com" target="_blank">링크</a>
          </p>
        </div>
        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
      </div>
    </footer>
    <!-- Js Plugins -->
    <script src="{% static 'mkjs/jquery-3.3.1.min.js'%}"></script>
    <script src="{% static 'mkjs/bootstrap.min.js'%}"></script>
    <script src="{% static 'mkjs/main.js'%}"></script>
    <script src="{% static 'mkjs/jquery.magnific-popup.min.js'%}"></script>
    <script src="{% static 'mkjs/jquery.nicescroll.min.js'%}"></script>
    <script src="{% static 'mkjs/jquery.countdown.min.js'%}"></script>
    <script src="{% static 'mkjs/jquery.slicknav.js'%}"></script>
    <script>
      function downloadImage(imageUrl) {
        const link = document.createElement("a");
        const filenameInput = document.getElementById("filename");
        const filename = filenameInput.value || "download.jpg";
        link.href = imageUrl;
        link.download = filename;
        link.click();
      }

      function postImage(nickname, imageUrl) {
        fetch("{% url 'making:post_image' %}", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}",
          },
          body: JSON.stringify({
            nickname: nickname,
            image_url: imageUrl,
          }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            if (data.success) {
              alert("글이 게시되었습니다.");
            } else {
              alert("이미지 게시 중 오류가 발생했습니다.");
            }
          })
          .catch((error) => {
            alert("이미지 게시 중 오류가 발생했습니다.");
            console.error("Error:", error);
          });
      }
    </script>
  </body>
</html>
