{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alive_Album</title>
    <!-- Css Styles -->
    <link rel="stylesheet" href="{% static 'mkcss/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'mkcss/rockville.css'%}">
    <link rel="stylesheet" href="{% static 'mkcss/slicknav.min.css'%}">
    <link rel="stylesheet" href="{% static 'mkcss/index.css'%}">
</head>
<body>
<!-- Page Preloder -->
<div id="preloder">
    <div class="loader"></div>
</div>
<header class="header">
    <div class="container">
        <div class="row">
            <div class="col-lg-2 col-md-2">
                <div class="header__logo">
                    <a href="/"><img src="/static/img/logo.png" alt=""></a>
                </div>
            </div>
            <div class="col-lg-10 col-md-10">
                <div class="header__nav">
                    <nav class="header__menu mobile-menu">
                        <ul>
                            <li class="active"><a href="/">HOME</a></li>
                            <li><a href="/making">MAKING</a></li>
                            <li><a href="/ranking">RANKING</a></li>
                            <li><a href="/board">BOARD</a></li>
                            <li><a href="/login">LOGIN</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        <div id="mobile-menu-wrap"></div>
    </div>
</header>
<!-- Main -->
<div class="wrapper style1">
    <div class="container">
        <div id="root">
            <div class="Contents">
                <div class="upload-box">
                    <svg viewBox="0 0 2500 400">
                        <symbol id="s-text">
                            <text text-anchor="middle" x="50%" y="80%">Create your Album Art</text>
                        </symbol>
                        <g class="g-ants">
                            <use xlink:href="#s-text" class="text-copy"></use>
                            <use xlink:href="#s-text" class="text-copy"></use>
                            <use xlink:href="#s-text" class="text-copy"></use>
                            <use xlink:href="#s-text" class="text-copy"></use>
                            <use xlink:href="#s-text" class="text-copy"></use>
                        </g>
                    </svg>
                    <div id="transformed-image-container" style="text-align: center;">
                    {% if transformed_image %}
                        <h2>변환된 이미지</h2>
                        <img src="data:image/jpeg;base64,{{ transformed_image }}" alt="Transformed Image">
                    {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Js Plugins -->
<script src="{% static 'mkjs/jquery-3.3.1.min.js'%}"></script>
<script src="{% static 'mkjs/bootstrap.min.js'%}"></script>
<script src="{% static 'mkjs/main.js'%}"></script>
<script src="{% static 'mkjs/jquery.magnific-popup.min.js'%}"></script>
<script src="{% static 'mkjs/jquery.nicescroll.min.js'%}"></script>
<script src="{% static 'mkjs/jquery.countdown.min.js'%}"></script>
<script src="{% static 'mkjs/jquery.slicknav.js'%}"></script>
<script>
    function handleFiles(files) {
        const imagePreviewContainer = document.getElementById("image-preview-container");
        const previewImage = document.getElementById("previewImage");

        if (files.length === 0) {
            imagePreviewContainer.innerHTML = "";  // 이미지 미리보기 컨테이너를 비웁니다.
            return;
        }

        const file = files[0];
        const reader = new FileReader();

        reader.onload = function(event) {
            const imageUrl = event.target.result;
            previewImage.src = imageUrl;

            // 선택한 이미지를 이미지 미리보기 컨테이너 안에도 표시할 수 있습니다. (선택사항)
            const imagePreview = document.createElement("img");
            imagePreview.src = imageUrl;
            imagePreviewContainer.innerHTML = "";  // 추가하기 전에 컨테이너를 비웁니다.
            imagePreviewContainer.appendChild(imagePreview);
        }

        reader.readAsDataURL(file);
    }

    function uploadImage(event) {
        event.preventDefault();

        const fileInput = document.getElementById("chooseImage");
        const file = fileInput.files[0];

        if (!file) {
            return;
        }

        const formData = new FormData();
        formData.append("image", file);
        formData.append("style", document.querySelector("select[name='style']").value);

        fetch("{% url 'making:transform' %}", {
            method: "POST",
            body: formData,
            headers: {
                "X-CSRFToken": document.querySelector("[name='csrfmiddlewaretoken']").value
            }
        })
        .then(response => response.json())
        .then(data => {
            localStorage.setItem('transformedImage', data.transformed_image);
            window.location.href = "{% url 'making:display' %}";
        })
        .catch(error => {
            console.error("Error:", error);
        });
    }

    const createAlbumArtButton = document.getElementById("create-album-art-button");
    createAlbumArtButton.addEventListener("click", uploadImage);

    const dropFile = document.getElementById("drop-file");
    dropFile.addEventListener("dragover", function(event) {
        event.preventDefault();
        dropFile.classList.add("dragover");
    });

    dropFile.addEventListener("dragleave", function() {
        dropFile.classList.remove("dragover");
    });

    dropFile.addEventListener("drop", function(event) {
        event.preventDefault();
        dropFile.classList.remove("dragover");
        handleFiles(event.dataTransfer.files);
    });

    // <input type="file"> 요소의 onchange 속성을 업데이트합니다.
    const fileInput = document.getElementById("chooseImage");
    fileInput.addEventListener("change", function(event) {
        handleFiles(event.target.files);
    });


</script>
</body>
</html>