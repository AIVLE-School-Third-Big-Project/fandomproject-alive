{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alive_Album</title>
    <!-- Css Styles -->
    <link rel="stylesheet" href="{% static 'mkcss/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'mkcss/rockville.css'%}" />
    <link rel="stylesheet" href="{% static 'mkcss/slicknav.min.css'%}" />
    <link rel="stylesheet" href="{% static 'mkcss/index.css'%}" />
  </head>
  <body>
    <!-- Page Preloder -->
    <div id="preloder">
      <div class="loader"></div>
    </div>
    <header class="header">
      <div class="container">
        <div class="row">
          <div class="col-lg-2 col-md-2">
            <div class="header__logo">
              <a href="/"><img src="/static/img/logo.png" alt="" /></a>
            </div>
          </div>
          <div class="col-lg-10 col-md-10">
            <div class="header__nav">
              <nav class="header__menu mobile-menu">
                <ul>
                  <li class="active"><a href="/">HOME</a></li>
                  <li><a href="/making">MAKING</a></li>
                  <li><a href="/ranking">RANKING</a></li>
                  <li><a href="/board">BOARD</a></li>
                  <li><a href="/login">LOGIN</a></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
        <div id="mobile-menu-wrap"></div>
      </div>
    </header>
    <!-- Main -->
    <div class="wrapper style1">
      <div class="container">
        <div id="root">
          <div class="Contents">
            <div class="upload-box">
              <svg viewBox="0 0 2500 400">
                <symbol id="s-text">
                  <text text-anchor="middle" x="50%" y="80%">
                    Create your Album Art
                  </text>
                </symbol>
                <g class="g-ants">
                  <use xlink:href="#s-text" class="text-copy"></use>
                  <use xlink:href="#s-text" class="text-copy"></use>
                  <use xlink:href="#s-text" class="text-copy"></use>
                  <use xlink:href="#s-text" class="text-copy"></use>
                  <use xlink:href="#s-text" class="text-copy"></use>
                </g>
              </svg>
              <form
                id="upload-form"
                action="{% url 'making:transform' %}"
                method="post"
                enctype="multipart/form-data"
              >
                {% csrf_token %}
                <input type="file" id="chooseImage" name="image" />
                <button type="submit">Upload</button>
              </form>
              <div id="drop-file">Or drag and drop files here</div>
              <div id="transformed-image-container" style="text-align: center">
                {% if transformed_image_url %}
                <h2>Transformed Image</h2>
                <img
                  id="transformed-image"
                  src="{{ transformed_image_url }}"
                  alt="Transformed Image"
                />
                <br />
                <input type="text" id="filename" placeholder="Enter filename" />
                <button
                  id="download-btn"
                  onclick="downloadImage('{{ transformed_image_url }}')"
                >
                  Download
                </button>
                {% else %}
                <p>No transformed image available.</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Js Plugins -->
    <script src="{% static 'mkjs/jquery-3.3.1.min.js'%}"></script>
    <script src="{% static 'mkjs/bootstrap.min.js'%}"></script>
    <script src="{% static 'mkjs/main.js'%}"></script>
    <script src="{% static 'mkjs/jquery.magnific-popup.min.js'%}"></script>
    <script src="{% static 'mkjs/jquery.nicescroll.min.js'%}"></script>
    <script src="{% static 'mkjs/jquery.countdown.min.js'%}"></script>
    <script src="{% static 'mkjs/jquery.slicknav.js'%}"></script>
    <script>
      function uploadImage(event) {
        event.preventDefault();

        const uploadForm = document.getElementById("upload-form");
        const formData = new FormData(uploadForm);

        fetch(uploadForm.action, {
          method: "POST",
          body: formData,
          headers: {
            "X-CSRFToken": document.querySelector(
              "[name='csrfmiddlewaretoken']"
            ).value,
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              const transformedImageContainer = document.getElementById(
                "transformed-image-container"
              );
              transformedImageContainer.innerHTML = `<h2>Transformed Image</h2><img id="transformed-image" src="${data.url}" alt="Transformed Image"><br><input type="text" id="filename" placeholder="Enter filename"><button id="download-btn" onclick="downloadImage('${data.download_url}')">Download</button>`;
            } else if (data.error) {
              alert(data.error);
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      function downloadImage(imageUrl) {
        const link = document.createElement("a");
        const filenameInput = document.getElementById("filename");
        const filename = filenameInput.value || "download.jpg";
        link.href = imageUrl;
        link.download = filename;
        link.click();
      }

      const uploadForm = document.getElementById("upload-form");
      uploadForm.addEventListener("submit", uploadImage);

      const dropFile = document.getElementById("drop-file");
      dropFile.addEventListener("dragover", function (event) {
        event.preventDefault();
        dropFile.classList.add("dragover");
      });

      dropFile.addEventListener("dragleave", function () {
        dropFile.classList.remove("dragover");
      });

      dropFile.addEventListener("drop", function (event) {
        event.preventDefault();
        dropFile.classList.remove("dragover");
        handleFiles(event.dataTransfer.files);
      });

      const fileInput = document.getElementById("chooseImage");
      fileInput.addEventListener("change", function (event) {
        handleFiles(event.target.files);
      });

      function handleFiles(files) {
        const fileInput = document.getElementById("chooseImage");
        fileInput.files = files;
      }
    </script>
  </body>
</html>
